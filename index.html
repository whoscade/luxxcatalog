<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LUXXCATALOG</title>
<style>
@font-face { font-family:'Experimento'; src:url('fonts/Experimento.ttf') format('truetype'); }
@font-face { font-family:'GadetyperRegular'; src:url('fonts/GadetyperRegular.otf') format('opentype'); }
@font-face { font-family:'timesnewarial'; src:url('fonts/timesnewarial.ttf') format('truetype'); }

html, body {
  margin:0;
  padding:0;
  height:100%;
  overflow:hidden;
  background:#ff0000;
  font-family:monospace;
  display:flex;
  justify-content:center;
  align-items:center;
}

#logo {
  font-size:clamp(2.5rem,12vw,8rem);
  line-height:1;
  white-space:nowrap;
  display:flex;
}

.letter { display:inline-block; }

#scrollMenu {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:50vh;
  background:linear-gradient(to bottom, #000 0%, #111 100%);
  box-shadow: inset 0 4px 12px #000, 0 4px 12px rgba(0,0,0,0.6);
  transform:translateY(100%);
  transition:transform 0.3s ease;
  z-index:1000;
  pointer-events:none;
  display:flex;
  flex-direction:column;
  padding:20px;
  box-sizing:border-box;
  border-radius:4px;
}

#scrollMenu.active { transform:translateY(0); pointer-events:auto; }

#menuBar {
  height:12%;
  display:flex;
  align-items:center;
  justify-content:flex-start;
  color:white;
  font-family:monospace;
  font-size:1.1rem;
  gap:25px;
  border-bottom:1px solid #181818;
  padding-bottom:8px;
  padding-left:12px;
}

#menuBar div {
  cursor:pointer;
  position:relative;
  text-transform:uppercase;
}

#menuBar div::after {
  content:'';
  position:absolute;
  width:0%;
  height:2px;
  bottom:-2px;
  left:0;
  background:#ff0000;
  transition:width 0.2s ease;
}

#menuBar div:hover::after { width:100%; }

#synthArea {
  flex:1;
  display:flex;
  justify-content:flex-start;
  align-items:flex-start;
  gap:20px;
  padding-top:45px;
}

#pads {
  display:flex;
  flex-direction:column;
  gap:16px;
  flex-shrink:0;
}

.padRow { display:flex; gap:16px; }

.pad {
  width:min(22vw,100px);
  height:min(22vw,100px);
  background:#181818;
  border-radius:6px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  position:relative;
  transition:0.1s;
  background-image:url('/imgs/button.jpg');
  background-size:cover;
}

.pad:hover { box-shadow:0 0 6px #ff0000 inset; }

.pad.active {
  box-shadow:0 0 6px #ff0000,0 0 12px #ff0000 inset;
}

#divider {
  width:2px;
  background:#181818;
  margin:0 20px;
}

#waveCanvas {
  width:180px;
  height:80px;
  margin-left:-5px;
  margin-top:0px;
  background:#181818;
  border-radius:6px;
  align-self:flex-start;
  box-shadow: inset 0 4px 12px #000;
}
</style>
</head>
<body>
<div id="logo"></div>

<div id="scrollMenu">
  <div id="menuBar">
    <div>ARCHIVE</div>
    <div>MAILING LIST</div>
  </div>

  <div id="synthArea">
    <div id="pads">
      <div class="padRow" id="padRowTop"></div>
      <div class="padRow" id="padRowBottom"></div>
    </div>

    <canvas id="waveCanvas" width="180" height="80"></canvas>
    <div id="divider"></div>
  </div>
</div>

<script>
const logoText="LUXXCATALOG";
const logo=document.getElementById('logo');
const fonts=['Experimento','GadetyperRegular','timesnewarial'];
function randomizeLogo(){
  logo.innerHTML='';
  for(let char of logoText){
    const span=document.createElement('span');
    span.classList.add('letter');
    span.textContent=char;
    span.style.fontFamily=fonts[Math.floor(Math.random()*fonts.length)];
    logo.appendChild(span);
  }
}
randomizeLogo();
setInterval(randomizeLogo,117);

const menu=document.getElementById('scrollMenu');
window.addEventListener('wheel', e=>{
  if(e.deltaY>0) menu.classList.add('active');
  else if(e.deltaY<0) menu.classList.remove('active');
});

let touchStartY=0, touchEndY=0;
window.addEventListener('touchstart', e=>{touchStartY=e.changedTouches[0].screenY;}, false);
window.addEventListener('touchend', e=>{
  touchEndY=e.changedTouches[0].screenY;
  const diff=touchStartY-touchEndY;
  if(diff>50) menu.classList.add('active');
  else if(diff<-50) menu.classList.remove('active');
}, false);

const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
const padRows=[document.getElementById('padRowTop'),document.getElementById('padRowBottom')];
const padData=new Map();
const canvas=document.getElementById('waveCanvas');
const ctx=canvas.getContext('2d');
const analyser=audioCtx.createAnalyser();
analyser.fftSize=1024;
const bufferLength=analyser.fftSize;
const dataArray=new Float32Array(bufferLength);
let displayedWave=new Float32Array(bufferLength).fill(canvas.height/2);

const bpm = 140;
const beatsPerBar = 4;
const barLength = (60/bpm) * beatsPerBar;
let loopStartTime = 0;

const sampleFiles=['kick.mp3','metal_snare.mp3'];
const sampleBuffers=[];

function loadSamples(){
  sampleFiles.forEach((file,i)=>{
    fetch('/sounds/'+file)
      .then(r=>r.arrayBuffer())
      .then(data=>audioCtx.decodeAudioData(data))
      .then(buffer=>{sampleBuffers[i]=buffer;});
  });
}
loadSamples();

function playSample(buffer,startTime){
  const source=audioCtx.createBufferSource();
  source.buffer=buffer;
  source.loop=true;
  source.connect(analyser).connect(audioCtx.destination);
  source.start(startTime);
  return source;
}

function getNextGridTime(){
  const now = audioCtx.currentTime;
  return loopStartTime + Math.ceil((now - loopStartTime)/barLength)*barLength;
}

function drawStaticWave(){
  const h=canvas.height;
  for(let i=0;i<displayedWave.length;i++){
    displayedWave[i]+=(h/2-displayedWave[i])*0.05;
  }
}

function drawWave(){
  requestAnimationFrame(drawWave);
  ctx.fillStyle='#181818';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.lineWidth=2;
  ctx.strokeStyle='#ff0000';
  ctx.beginPath();
  if(padData.size>0){
    analyser.getFloatTimeDomainData(dataArray);
    for(let i=0;i<bufferLength;i++){
      displayedWave[i]+=((canvas.height/2 + dataArray[i]*0.8*canvas.height/2)-displayedWave[i])*0.2;
      const x=i*canvas.width/bufferLength;
      const y=displayedWave[i];
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
  } else drawStaticWave();
  for(let i=0;i<bufferLength;i++){
    const x=i*canvas.width/bufferLength;
    const y=displayedWave[i];
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.stroke();
}
drawWave();

for(let i=0;i<12;i++){
  const pad=document.createElement('div');
  pad.classList.add('pad');
  padRows[i<6?0:1].appendChild(pad);

  pad.addEventListener('click',()=>{
    if(pad.classList.contains('active')){
      const data=padData.get(pad);
      if(data) data.source.stop();
      padData.delete(pad);
      pad.classList.remove('active');
    } else {
      let buffer=null;
      if(i<sampleBuffers.length) buffer=sampleBuffers[i];
      if(!buffer) return;

      let startTime;
      if(padData.size===0){
        startTime=audioCtx.currentTime;
        loopStartTime=startTime;
      } else {
        startTime=getNextGridTime();
      }

      const source=playSample(buffer,startTime);
      padData.set(pad,{source});
      pad.classList.add('active');
    }
  });
}
</script>
</body>
</html>
